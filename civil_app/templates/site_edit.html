{% extends "base.html" %}
{% load civil_extras %}
{% block content %}

<!-- ================= PAGE TITLE ================= -->
<div class="mb-6">
  <h2 class="text-2xl font-bold text-gray-800">
    âœ Edit Daily Entry â€“ {{ site.name }}
  </h2>
  <p class="text-sm text-gray-500">
    Select date â†’ Edit labour & material â†’ Update
  </p>
</div>

<!-- ================= DATE SELECT (GET) ================= -->
<form method="get" class="mb-6 flex gap-3 items-end">
  <div>
    <label class="block text-sm font-semibold mb-1">Date</label>
    <input type="date"
           name="date"
           value="{{ date|date:'Y-m-d' }}"
           class="border p-2 rounded w-40">
  </div>
  <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded">
    Load
  </button>
</form>

<!-- ================= EDIT FORM (POST) ================= -->
<form method="post" action="">
{% csrf_token %}
<input type="hidden" name="date" value="{{ date|date:'Y-m-d' }}">

<!-- ================= CIVIL TEAMS ================= -->
<div class="bg-white rounded-xl shadow p-5 mb-8">
  <h3 class="text-lg font-bold text-blue-700 mb-4">
    ğŸ— Civil Teams
  </h3>

  <!-- Header -->
  <div class="grid grid-cols-6 gap-2 text-xs font-semibold text-gray-500 mb-2">
    <div>Team</div>
    <div>M Full</div>
    <div>H Full</div>
    <div>M Half</div>
    <div>H Half</div>
    <div>Material â‚¹</div>
  </div>

  <!-- Rows -->
  {% for team in teams %}
    {% with work=civil_map|get_item:team.id %}
    <div class="grid grid-cols-6 gap-2 mb-2 items-center">
      <div class="font-medium">{{ team.name }}</div>

      <input type="number"
             name="mason_full_{{ team.id }}"
             value="{{ work.mason_full|default:0 }}"
             class="border p-2 rounded">


      <input type="number"
             name="helper_full_{{ team.id }}"
             value="{{ work.helper_full|default:0 }}"
             class="border p-2 rounded">

      <input type="number"
             name="mason_half_{{ team.id }}"
             value="{{ work.mason_half|default:0 }}"
             class="border p-2 rounded">

      <input type="number"
             name="helper_half_{{ team.id }}"
             value="{{ work.helper_half|default:0 }}"
             class="border p-2 rounded">

      <input type="number"
             name="material_{{ team.id }}"
             value="{{ work.material_amount|default:0 }}"
             class="border p-2 rounded">
    </div>
    {% endwith %}
  {% endfor %}
</div>

<!-- ================= OTHER DEPARTMENTS ================= -->
<div class="bg-white rounded-xl shadow p-5 mb-8">
  <h3 class="text-lg font-bold text-orange-600 mb-4">
    ğŸ¢ Other Departments
  </h3>

  <!-- Header -->
  <div class="grid grid-cols-4 gap-2 text-xs font-semibold text-gray-500 mb-2">
    <div>Department</div>
    <div>Full</div>
    <div>Half</div>
    <div>Material â‚¹</div>
  </div>

  <!-- Rows -->
  {% for dept in departments %}
    {% with row=dept_map|get_item:dept.id %}
    <div class="grid grid-cols-4 gap-2 mb-2 items-center">
      <div class="font-medium">{{ dept.name }}</div>

      <input type="number"
             name="dept_full_{{ dept.id }}"
             value="{{ row.full_day_count|default:0 }}"
             class="border p-2 rounded">

      <input type="number"
             name="dept_half_{{ dept.id }}"
             value="{{ row.half_day_count|default:0 }}"
             class="border p-2 rounded">

      <input type="number"
             name="dept_material_{{ dept.id }}"
             value="{{ row.material_amount|default:0 }}"
             class="border p-2 rounded">
    </div>
    {% endwith %}
  {% endfor %}
</div>

<!-- ================= ACTION BAR ================= -->
<div class="flex justify-end gap-3 sticky bottom-0 bg-white border-t pt-4">
  <a href="{% url 'site_detail' site.id %}"
     class="px-4 py-2 rounded border text-gray-700">
    Cancel
  </a>

  <button type="submit"
          class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded font-semibold">
    âœ… Update Entry
  </button>
</div>

</form>

{% endblock %}
