{% extends "base.html" %}
{% block content %}

<div class="max-w-6xl mx-auto space-y-10">

  <!-- ================= PAGE HEADER ================= -->
  <div>
    <h1 class="text-3xl font-bold text-slate-800 flex items-center gap-2">
      üí∞ Payment Settings
    </h1>
    <p class="text-sm text-gray-500 mt-1">
      Configure default labour payments for departments and civil teams
    </p>
  </div>

  <!-- ========================================================= -->
  <!-- ================= DEPARTMENT PAYMENT ==================== -->
  <!-- ========================================================= -->
  <div class="bg-white rounded-2xl shadow-lg p-6">

    <h2 class="text-xl font-bold text-orange-600 mb-4">
      üè¢ Department Default Payment
    </h2>

    <!-- ADD / UPDATE FORM -->
    <form method="post"
          class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
      {% csrf_token %}
      <input type="hidden" name="pay_type" value="dept">

      <select name="department"
              class="border p-3 rounded-lg">
        {% for d in departments %}
          <option value="{{ d.id }}">{{ d.name }}</option>
        {% endfor %}
      </select>

      <input type="number"
             name="full"
             min="1"
             required
             placeholder="Full day ‚Çπ"
             class="border p-3 rounded-lg">

      <button
        class="bg-orange-600 hover:bg-orange-700 text-white py-3 rounded-lg font-semibold">
        Save Payment
      </button>
    </form>

    <!-- MOBILE VIEW (CARDS) -->
    <div class="space-y-3 md:hidden">
      {% for r in rates %}
      <div class="border rounded-xl p-4">
        <p class="font-semibold text-gray-800">
          {{ r.department.name }}
        </p>
        <p class="text-sm text-gray-500 mt-1">
          Full: ‚Çπ{{ r.full_day_rate }} <br>
          Half: ‚Çπ{{ r.half_day_rate }}
        </p>
      </div>
      {% empty %}
      <p class="text-gray-500 text-sm">No department payments added</p>
      {% endfor %}
    </div>

    <!-- DESKTOP VIEW (TABLE) -->
    <div class="hidden md:block overflow-x-auto">
      <table class="w-full text-sm border rounded-lg overflow-hidden">
        <thead class="bg-slate-800 text-white">
          <tr>
            <th class="p-3 text-left">Department</th>
            <th class="p-3 text-center">Full Day ‚Çπ</th>
            <th class="p-3 text-center">Half Day ‚Çπ</th>
          </tr>
        </thead>
        <tbody class="divide-y">
          {% for r in rates %}
          <tr class="hover:bg-gray-50">
            <td class="p-3 font-medium">{{ r.department.name }}</td>
            <td class="p-3 text-center text-orange-600 font-semibold">
              ‚Çπ{{ r.full_day_rate }}
            </td>
            <td class="p-3 text-center text-gray-700">
              ‚Çπ{{ r.half_day_rate }}
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="3"
                class="p-4 text-center text-gray-500">
              No department payments configured
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

  </div>

  <!-- ========================================================= -->
  <!-- ================= CIVIL TEAM PAYMENT ==================== -->
  <!-- ========================================================= -->
  <div class="bg-white rounded-2xl shadow-lg p-6">

    <h2 class="text-xl font-bold text-blue-700 mb-4">
      üë∑ Civil Team Default Payment
    </h2>

    <!-- ADD TEAM PAYMENT -->
    <form method="post"
          class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-6">
      {% csrf_token %}
      <input type="hidden" name="pay_type" value="civil">

      <select name="team"
              class="border p-3 rounded-lg">
        {% for t in teams %}
          <option value="{{ t.id }}">{{ t.name }}</option>
        {% endfor %}
      </select>

      <input type="number"
             name="mason"
             min="1"
             required
             placeholder="Mason ‚Çπ"
             class="border p-3 rounded-lg">

      <input type="number"
             name="helper"
             min="1"
             required
             placeholder="Helper ‚Çπ"
             class="border p-3 rounded-lg">

      <button
        class="bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg font-semibold">
        Save Team Payment
      </button>
    </form>

    <!-- MOBILE VIEW (CARDS + INLINE EDIT) -->
    <div class="space-y-4 md:hidden">
      {% for r in team_rates %}
      <div class="border rounded-xl p-4">
        <p class="font-semibold text-gray-800">
          {{ r.team.name }}
        </p>

        <p class="text-sm text-gray-500 mt-1">
          Mason: ‚Çπ{{ r.mason_full_rate }} <br>
          Helper: ‚Çπ{{ r.helper_full_rate }}
        </p>

        <form method="post" class="flex gap-2 mt-3">
          {% csrf_token %}
          <input type="hidden" name="pay_type" value="civil">
          <input type="hidden" name="team" value="{{ r.team.id }}">

          <input type="number"
                 name="mason"
                 value="{{ r.mason_full_rate }}"
                 class="border p-2 rounded-lg w-full">

          <input type="number"
                 name="helper"
                 value="{{ r.helper_full_rate }}"
                 class="border p-2 rounded-lg w-full">

          <button
            class="bg-green-600 text-white px-4 rounded-lg">
            Update
          </button>
        </form>
      </div>
      {% empty %}
      <p class="text-gray-500 text-sm">No team payments configured</p>
      {% endfor %}
    </div>

    <!-- DESKTOP VIEW (TABLE) -->
    <div class="hidden md:block overflow-x-auto">
      <table class="w-full text-sm border rounded-lg overflow-hidden">
        <thead class="bg-slate-800 text-white">
          <tr>
            <th class="p-3 text-left">Team</th>
            <th class="p-3 text-center">Mason ‚Çπ</th>
            <th class="p-3 text-center">Helper ‚Çπ</th>
            <th class="p-3 text-center">Update</th>
          </tr>
        </thead>
        <tbody class="divide-y">
          {% for r in team_rates %}
          <tr class="hover:bg-gray-50">
            <td class="p-3 font-medium">{{ r.team.name }}</td>
            <td class="p-3 text-center text-blue-600 font-semibold">
              ‚Çπ{{ r.mason_full_rate }}
            </td>
            <td class="p-3 text-center text-gray-700">
              ‚Çπ{{ r.helper_full_rate }}
            </td>
            <td class="p-3">
              <form method="post"
                    class="flex gap-2 justify-center">
                {% csrf_token %}
                <input type="hidden" name="pay_type" value="civil">
                <input type="hidden" name="team" value="{{ r.team.id }}">

                <input type="number"
                       name="mason"
                       value="{{ r.mason_full_rate }}"
                       class="border p-1 w-20 rounded-lg">

                <input type="number"
                       name="helper"
                       value="{{ r.helper_full_rate }}"
                       class="border p-1 w-20 rounded-lg">

                <button
                  class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded-lg text-xs font-semibold">
                  Update
                </button>
              </form>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="4"
                class="p-4 text-center text-gray-500">
              No team payments configured
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

  </div>

</div>

{% endblock %}
